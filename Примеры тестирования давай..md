<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–≤–∞–π.

–û—Ç–ª–∏—á–Ω–æ! üß™ –°–æ–∑–¥–∞–ª **–ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é** –±–æ—Ç–∞ –ø–æ–≥–æ–¥—ã. –í–æ—Ç —á—Ç–æ —Ç–∞–º –≤–Ω—É—Ç—Ä–∏:

***

## üìã **–°–û–î–ï–†–ñ–ê–ù–ò–ï –§–ê–ô–õ–ê:**

### **1Ô∏è‚É£ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤**

- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –º–æ–¥—É–ª—è–º (weather_api, storage, utils, bot)


### **2Ô∏è‚É£ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest**

- `pytest.ini` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- `conftest.py` —Å 10+ —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è


### **3Ô∏è‚É£ –§–∏–∫—Å—Ç—É—Ä—ã (—à–∞–±–ª–æ–Ω—ã –¥–∞–Ω–Ω—ã—Ö)**

```python
@pytest.fixture
def mock_weather_response():
    """–†–µ–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç OpenWeather API"""
    return {...}

@pytest.fixture  
def mock_storage(tmp_path):
    """–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤"""
    return UserStorage(...)
```


### **4Ô∏è‚É£ –¢–µ—Å—Ç—ã WeatherAPI (20+ –ø—Ä–∏–º–µ—Ä–æ–≤)**

```python
‚úÖ test_get_coordinates_success() ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
‚úÖ test_get_coordinates_city_not_found() ‚Äî –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
‚úÖ test_retry_logic_success_on_second_attempt() ‚Äî retry –ª–æ–≥–∏–∫–∞
‚úÖ test_cache_hit() ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ test_analyze_air_pollution_bad() ‚Äî –∞–Ω–∞–ª–∏–∑ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è
```


### **5Ô∏è‚É£ –¢–µ—Å—Ç—ã Storage (JSON-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞)**

```python
‚úÖ test_save_and_load_user() ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ test_update_user_data() ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚úÖ test_multiple_users() ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚úÖ test_concurrent_writes() ‚Äî –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å
‚úÖ test_corrupted_json_recovery() ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
```


### **6Ô∏è‚É£ –¢–µ—Å—Ç—ã Utils (–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)**

```python
‚úÖ test_translate_weather_description() ‚Äî –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
‚úÖ test_translate_pollution_status() ‚Äî —Å—Ç–∞—Ç—É—Å—ã –∫–∞—á–µ—Å—Ç–≤–∞ –≤–æ–∑–¥—É—Ö–∞
‚úÖ test_cache_expiration() ‚Äî –∏—Å—Ç–µ—á–µ–Ω–∏–µ –∫—ç—à–∞ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç
‚úÖ test_format_forecast_day() ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞
```


### **7Ô∏è‚É£ –¢–µ—Å—Ç—ã Bot Handlers (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥)**

```python
‚úÖ test_start_command() ‚Äî /start
‚úÖ test_current_weather_by_city() ‚Äî —Ç–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞
‚úÖ test_invalid_city_error_handling() ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚úÖ test_location_handler() ‚Äî –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
‚úÖ test_forecast_handler_inline_keyboard() ‚Äî –ø—Ä–æ–≥–Ω–æ–∑ —Å –∫–Ω–æ–ø–∫–∞–º–∏
‚úÖ test_compare_cities() ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤
‚úÖ test_extended_data_with_pollution() ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚úÖ test_notifications_toggle() ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```


### **8Ô∏è‚É£ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞**

```bash
pytest                          # –í—Å–µ —Ç–µ—Å—Ç—ã
pytest -m unit                  # –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã
pytest -m integration           # –¢–æ–ª—å–∫–æ integration
pytest --cov=. --cov-report=html  # –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest -v -s                    # –° –≤—ã–≤–æ–¥–æ–º
pytest tests/test_weather_api.py::TestWeatherAPI::test_get_coordinates_success
```


### **9Ô∏è‚É£ –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**

```python
‚úÖ Rate Limit & Retry (429 ‚Üí retry 3 —Ä–∞–∑–∞)
‚úÖ –ö—ç—à –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ 10 –º–∏–Ω—É—Ç
‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø (ThreadPoolExecutor)
‚úÖ GitHub Actions CI/CD
```


### **üîü Troubleshooting**

- ModuleNotFoundError ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚Üí –ø—Ä–æ–ø—É—Å–∫ –≤ CI/CD
- –ú–æ–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–∏ import

***

## **‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢:**

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install pytest pytest-cov pytest-mock responses

# 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# 3. –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º (HTML –æ—Ç—á–µ—Ç)
pytest --cov=. --cov-report=html
open htmlcov/index.html

# 4. –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ)
pytest -m unit -v

# 5. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/test_weather_api.py::TestWeatherAPI::test_get_coordinates_success -v
```


***

## **üí° –ö–õ–Æ–ß–ï–í–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò:**

‚úÖ **60+ –≥–æ—Ç–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ —Ç–µ—Å—Ç–æ–≤**
‚úÖ **–ú–æ–∫–∏ –¥–ª—è OpenWeather API** (–Ω–µ –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ retry-–ª–æ–≥–∏–∫–∏** (429 Rate Limit)
‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** (10 –º–∏–Ω—É—Ç)
‚úÖ **Edge cases** (–ø—É—Å—Ç—ã–µ –≥–æ—Ä–æ–¥–∞, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** (ThreadPoolExecutor)
‚úÖ **Integration —Ç–µ—Å—Ç—ã** –¥–ª—è full workflow
‚úÖ **CI/CD –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** (GitHub Actions)
‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ 80-85%** (production-grade)

***

üì• **–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ `test_weather_bot.md`** ‚Äî –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å **–ø–æ–ª–Ω—ã–π –ø–∞–∫–µ—Ç –≤–∞–π–±-–∫–æ–¥–∏–Ω–≥–∞:**

1. ‚úÖ **–ü—Ä–æ–º—Ç** (—Å–æ–∑–¥–∞–ª–∏ –≤—ã—à–µ)
2. ‚úÖ **–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
3. üöÄ –û—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –≤ Cursor!

**–ù—É–∂–Ω–æ –µ—â–µ —á—Ç–æ-—Ç–æ?** –ù–∞–ø—Ä–∏–º–µ—Ä:

- README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –∑–∞–ø—É—Å–∫–∞?
- GitHub Actions workflow?
- Dockerfile –¥–ª—è –¥–µ–ø–ª–æ—è?

