<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# API –ø–æ–≥–æ–¥–∞ —Ç–≥ –±–æ—Ç.

–°–æ–∑–¥–∞–π –ø—Ä–æ–º—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á–∏ –æ–ø–∏—Å–∞–Ω–Ω–æ–π –Ω–∏–∂–µ:

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–°–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
bot.py,¬†weather_app.py,¬†storage.py,¬†requirements.txt,¬†.gitignore,¬†.env.example,¬†User_Data.json¬†(–ø—É—Å—Ç–æ–π¬†{}),¬†README.md.
–í¬†.gitignore¬†–¥–æ–±–∞–≤—å:¬†.env,¬†venv/,¬†__pycache__/.
–ó–∞–ø–æ–ª–Ω–∏¬†.env.example¬†–∫–ª—é—á–∞–º–∏-–∑–∞–≥–ª—É—à–∫–∞–º–∏:
OW_API_KEY=your_openweather_key
BOT_TOKEN=your_telegram_token
–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
requirements.txt:¬†requests,¬†python-dotenv,¬†pyTelegramBotAPI.
–ú–æ–¥—É–ª—å –ø–æ–≥–æ–¥—ã (weather_app.py)
–§—É–Ω–∫—Ü–∏–∏:
get_coordinates(city: str, limit: int = 1) -> tuple[float, float] | None¬†(OpenWeather¬†Geocoding,¬†lang=ru).
get_current_weather(lat: float, lon: float) -> dict¬†(Current Weather,¬†units=metric\&lang=ru).
get_forecast_5d3h(lat: float, lon: float) -> list[dict]¬†(5-–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ —Å —à–∞–≥–æ–º 3 —á).
get_air_pollution(lat: float, lon: float) -> dict¬†(Air Pollution,¬†list[0].components).
analyze_air_pollution(components: dict, extended: bool=False) -> dict¬†(—Å–≤–æ–¥–Ω—ã–π —Å—Ç–∞—Ç—É—Å + –¥–µ—Ç–∞–ª–∏).
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏, 4xx/5xx, –ø—É—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–π¬†None/—Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ç—Ä–µ–π—Å–±–µ–∫–æ–≤.
–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (storage.py)
load_user(user_id: int) -> dict,¬†save_user(user_id: int, data: dict) -> None
–î–∞–Ω–Ω—ã–µ –≤¬†User_Data.json:¬†{"<user_id>": {"city": "...", "lat": ..., "lon": ..., "notifications": {"enabled": true, "interval_h": 2}}}.
Telegram-–±–æ—Ç (bot.py)
–ö–æ–º–∞–Ω–¥—ã/–∫–Ω–æ–ø–∫–∏:
/start¬†‚Äî –º–µ–Ω—é.
¬´–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞¬ª (–ø–æ –≥–æ—Ä–æ–¥—É¬†–∏–ª–∏¬†–≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏).
¬´–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π¬ª ‚Äî inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –≤—ã–±–æ—Ä–æ–º –¥–Ω—è; –ø—Ä–∏ –≤—ã–±–æ—Ä–µ ‚Äî —É–≥–ª—É–±–ª–µ–Ω–∏–µ –∏ ¬´–ù–∞–∑–∞–¥¬ª.
¬´–ú–æ—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è¬ª ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç¬†location, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
¬´–°—Ä–∞–≤–Ω–∏—Ç—å –≥–æ—Ä–æ–¥–∞¬ª ‚Äî –∑–∞–ø—Ä–æ—Å –¥–≤—É—Ö –≥–æ—Ä–æ–¥–æ–≤ ‚Üí —Ç–∞–±–ª–∏—á–Ω—ã–π –≤—ã–≤–æ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä.
¬´–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ¬ª ‚Äî –ø–æ–≥–æ–¥–∞ + –∞–Ω–∞–ª–∏–∑ Air Quality (RU-—Å—Ç–∞—Ç—É—Å—ã).
¬´–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è¬ª ‚Äî –≤–∫–ª/–≤—ã–∫–ª –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª (—á–∞—Å—ã). –ò–º–∏—Ç–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞: –ø—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∞–ø–¥–µ–π—Ç–∞—Ö (–∏–ª–∏ —Ç–∞–π–º–µ—Ä –ø–æ—Ç–æ–∫–∞).
–¢–æ–∫–µ–Ω—ã –∏–∑¬†.env¬†—á–µ—Ä–µ–∑¬†python-dotenv. –í –∫–æ–¥–µ –∫–ª—é—á–µ–π –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ.
–ú–∏–Ω–∏-–ø—Ä–æ–≤–µ—Ä–∫–∏
–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω¬ª.
–ü—É—Å—Ç–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è ‚Üí –ø—Ä–æ—Å—å–±–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å¬†location.
Rate limit/429 ‚Üí –¥–æ 3 —Ä–µ—Ç—Ä–∞–µ–≤ —Å –ø–∞—É–∑–æ–π 1s/2s/4s.

7.¬†–ö—ç—à OpenWeather
–ö—ç—à–∏—Ä—É–π –æ—Ç–≤–µ—Ç—ã –Ω–∞ 10 –º–∏–Ω –≤¬†./.cache/*.json¬†–ø–æ –∫–ª—é—á—É¬†lat,lon,endpoint.
–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
–ü–µ—Ä–µ–≤–µ–¥–∏ —Å—Ç–∞—Ç—É—Å—ã –∏–∑¬†analyze_air_pollution¬†–∏ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–≥–æ–¥—ã –Ω–∞ —Ä—É—Å—Å–∫–∏–π (–µ—Å–ª–∏ API –≤–µ—Ä–Ω—É–ª EN).
Inline-—Ä–µ–∂–∏–º
–ü—Ä–æ—Å—Ç–æ–π inline-–æ—Ç–≤–µ—Ç: –ø–æ –≤–≤–æ–¥—É –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ ¬´–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ / –æ–ø–∏—Å–∞–Ω–∏–µ / —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑¬ª.

Perfect! üéØ –¢–µ–ø–µ—Ä—å —É –º–µ–Ω—è –µ—Å—Ç—å –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è. –°–æ–∑–¥–∞–º **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–∞–π–±-–∫–æ–¥–µ—Ä—Å–∫–∏–π –ø—Ä–æ–º—Ç** –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram-–±–æ—Ç–∞ –ø–æ–≥–æ–¥—ã, –∏—Å–ø–æ–ª—å–∑—É—è:

‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ ARCHITECTURE.md
‚úÖ –û–û–ü –ø–æ–¥—Ö–æ–¥ –∏–∑ Space Files
‚úÖ –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ API-–ø–æ–≥–æ–¥–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

***

# üå§Ô∏è –ü–†–û–ú–¢ –î–õ–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò TELEGRAM-–ë–û–¢–ê –ü–û–ì–û–î–´

## **–ò–î–ï–Ø**

–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π:

- üå°Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –ø–æ –≥–æ—Ä–æ–¥—É –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- üìÖ –í—ã–≤–æ–¥–∏—Ç 5-–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –¥–Ω–µ–π
- üåç –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É –≤ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö
- üí® –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞ —Å —Ä—É—Å—Å–∫–∏–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- üì¨ –ü—Ä–∏—Å—ã–ª–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–≥–æ–¥–µ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
- üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ `.env` –∏ `python-dotenv`

***

## **–ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê**

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫/—Ñ–∞–π–ª–æ–≤:**

```
weather_bot/
‚îú‚îÄ‚îÄ bot.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞ + –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ weather_app.py         # –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å OpenWeather API
‚îú‚îÄ‚îÄ storage.py             # –†–∞–±–æ—Ç–∞ —Å User_Data.json
‚îú‚îÄ‚îÄ utils.py              # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∫—ç—à, –ø–µ—Ä–µ–≤–æ–¥, —Ä–µ—Ç—Ä–∞–π)
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example          # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore            # .env, venv/, __pycache__/
‚îú‚îÄ‚îÄ User_Data.json        # {}
‚îú‚îÄ‚îÄ .cache/               # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã API (10 –º–∏–Ω)
‚îî‚îÄ‚îÄ README.md             # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
```


### **–ú–æ–¥—É–ª–∏ –∏ –∫–ª–∞—Å—Å—ã**

#### **1. weather_app.py** ‚Äî –ú–æ–¥—É–ª—å –ø–æ–≥–æ–¥—ã (–æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

**–ö–ª–∞—Å—Å `WeatherAPI`:**

- `__init__(api_key)` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å API-–∫–ª—é—á–æ–º
- `get_coordinates(city: str, limit: int = 1) -> tuple | None` ‚Äî –≥–µ–æ–∫–æ–¥–∏–Ω–≥ (OpenWeather Geocoding, lang=ru)
- `get_current_weather(lat: float, lon: float) -> dict` ‚Äî —Ç–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ (units=metric\&lang=ru)
- `get_forecast_5d3h(lat: float, lon: float) -> list[dict]` ‚Äî 5-–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ —Å —à–∞–≥–æ–º 3—á
- `get_air_pollution(lat: float, lon: float) -> dict` ‚Äî –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞ (components)
- `analyze_air_pollution(components: dict, extended: bool = False) -> dict` ‚Äî –∞–Ω–∞–ª–∏–∑ —Å RU-—Å—Ç–∞—Ç—É—Å–∞–º–∏

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

- –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç `None` + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- 4xx/5xx –∫–æ–¥—ã ‚Üí retry –¥–æ 3 —Ä–∞–∑ (1s, 2s, 4s –ø–∞—É–∑—ã)
- –ü—É—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç `None` –±–µ–∑ —Ç—Ä–µ–π—Å–±–µ–∫–∞

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (10 –º–∏–Ω):**

- `.cache/lat_lon_endpoint.json`
- –ö–ª—é—á: `f"{lat}_{lon}_{endpoint_name}"`


#### **2. storage.py** ‚Äî –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (JSON)

**–ö–ª–∞—Å—Å `UserStorage`:**

- `load_user(user_id: int) -> dict` ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `save_user(user_id: int, data: dict) -> None` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `load_all() -> dict` ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ User_Data.json:**

```json
{
  "123456": {
    "city": "–ú–æ—Å–∫–≤–∞",
    "lat": 55.7558,
    "lon": 37.6173,
    "notifications": {
      "enabled": true,
      "interval_h": 2,
      "last_sent": "2025-12-04 10:30"
    }
  }
}
```


#### **3. utils.py** ‚Äî –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- `translate_weather_description(desc: str) -> str` ‚Äî –ø–µ—Ä–µ–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–∏–π
- `translate_pollution_status(status: str) -> str` ‚Äî RU-—Å—Ç–∞—Ç—É—Å—ã –∫–∞—á–µ—Å—Ç–≤–∞ –≤–æ–∑–¥—É—Ö–∞
- `retry_request(func, *args, **kwargs)` ‚Äî —Ä–µ—Ç—Ä–∞–π —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø–∞—É–∑–æ–π
- `load_cache(key: str) -> dict | None` ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—ç—à (–µ—Å–ª–∏ –Ω–µ —Å—Ç–∞—Ä—à–µ 10 –º–∏–Ω)
- `save_cache(key: str, data: dict) -> None` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫—ç—à
- `format_forecast_day(forecast_items: list) -> str` ‚Äî –∫—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –¥–Ω—è –ø—Ä–æ–≥–Ω–æ–∑–∞


#### **4. bot.py** ‚Äî Telegram-–±–æ—Ç (–≥–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å)

**–ö–ª–∞—Å—Å `WeatherBot`:**

- `__init__()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞, API, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥:
    - `/start` ‚Üí –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    - `–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞` ‚Üí –ø–æ –≥–æ—Ä–æ–¥—É –∏–ª–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (—Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π)
    - `–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π` ‚Üí inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –≤—ã–±–æ—Ä–æ–º –¥–Ω—è + —É–≥–ª—É–±–ª–µ–Ω–∏–µ + "–ù–∞–∑–∞–¥"
    - `–ú–æ—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è` ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç location, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
    - `–°—Ä–∞–≤–Ω–∏—Ç—å –≥–æ—Ä–æ–¥–∞` ‚Üí –∑–∞–ø—Ä–æ—Å 2 –≥–æ—Ä–æ–¥–æ–≤ ‚Üí —Ç–∞–±–ª–∏—Ü–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä
    - `–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ` ‚Üí –ø–æ–≥–æ–¥–∞ + Air Quality Analysis (RU-—Å—Ç–∞—Ç—É—Å—ã)
    - `–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è` ‚Üí –≤–∫–ª/–≤—ã–∫–ª + —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (threading):**

- –ü–æ—Ç–æ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç)
- –ü—Ä–∏ –≤—Ö–æ–¥—è—â–µ–º –∞–ø–¥–µ–π—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

***

## **–¢–†–ï–ë–û–í–ê–ù–ò–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

### **1. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ –û–û–ü**

- ‚úÖ –ö–ª–∞—Å—Å `WeatherAPI` —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
- ‚úÖ –ö–ª–∞—Å—Å `UserStorage` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏-–ø–æ–º–æ—â–Ω–∏–∫–∏ –≤ `utils.py`
- ‚úÖ –ö–ª–∞—Å—Å `WeatherBot` —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ (–º–µ—Ç–æ–¥—ã `handle_*`)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è INFO –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π


### **2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

- ‚úÖ –í—Å–µ –∫–ª—é—á–∏ –∏–∑ `.env` —á–µ—Ä–µ–∑ `python-dotenv`
- ‚úÖ `.env.example` —Å –∑–∞–≥–ª—É—à–∫–∞–º–∏:

```
OW_API_KEY=your_openweather_key
BOT_TOKEN=your_telegram_token
```

- ‚úÖ `.gitignore`: `.env, venv/, __pycache__/`
- ‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –∫–ª—é—á–µ–π –≤ –∫–æ–¥–µ**


### **3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

- ‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí "–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω"
- ‚úÖ –ü—É—Å—Ç–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è ‚Üí "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
- ‚úÖ Rate limit (429) ‚Üí retry –¥–æ 3 —Ä–∞–∑ (1s, 2s, 4s)
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ ‚Üí graceful fallback —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º


### **4. –í–∞–ª–∏–¥–∞—Ü–∏—è**

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (lat [-90, 90], lon [-180, 180])
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–æ—Ç 1 –¥–æ 24 —á–∞—Å–æ–≤)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email/—Ç–µ–ª–µ—Ñ–æ–Ω–∞ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è


### **5. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**

- ‚úÖ –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–≥–æ–¥—ã –Ω–∞ —Ä—É—Å—Å–∫–∏–π
- ‚úÖ –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –∫–∞—á–µ—Å—Ç–≤–∞ –≤–æ–∑–¥—É—Ö–∞ –Ω–∞ —Ä—É—Å—Å–∫–∏–π (–•–æ—Ä–æ—à–æ, –ü—Ä–∏–µ–º–ª–µ–º–æ, –ü–ª–æ—Ö–æ, –û—á–µ–Ω—å –ø–ª–æ—Ö–æ, –ß—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ –ø–ª–æ—Ö–æ)
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –†–æ—Å—Å–∏–∏ (dd.mm.yyyy HH:MM)


### **6. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**

- ‚úÖ –û—Ç–≤–µ—Ç—ã –Ω–∞ 10 –º–∏–Ω—É—Ç –≤ `.cache/lat_lon_endpoint.json`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫—ç—à–µ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏


### **7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–∏–º–∏—Ç–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞)**

- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∞–ø–¥–µ–π—Ç–∞—Ö
- ‚úÖ –¢–∞–π–º–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `last_sent` –≤ User_Data.json
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ N —á–∞—Å–æ–≤ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è


### **8. Inline-—Ä–µ–∂–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

- ‚úÖ –ü–æ –≤–≤–æ–¥—É –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ ‚Üí –∫–∞—Ä—Ç–æ—á–∫–∞ —Å —Ç–µ–∫—É—â–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π, –æ–ø–∏—Å–∞–Ω–∏–µ–º, —Å—Å—ã–ª–∫–æ–π –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑

***

## **–ó–ê–í–ò–°–ò–ú–û–°–¢–ò** (requirements.txt)

```
requests==2.31.0
python-dotenv==1.0.0
pyTelegramBotAPI==4.14.1
```


***

## **–¢–ï–•–ù–ò–ö–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

### **–¶–µ–ø–æ—á–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**

1. **–ò–¥–µ—è ‚Üí –ü—Ä–æ–º–ø—Ç** (—Ç—ã —ç—Ç—É —á–∞—Å—Ç—å —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—à—å üëÜ)
2. **–ü—Ä–æ–º–ø—Ç ‚Üí –ö–æ–¥**
    - –ö–æ–ø–∏—Ä—É–µ—à—å —ç—Ç–æ—Ç –ø—Ä–æ–º—Ç –≤ Cursor
    - Cursor –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–¥ –ø–æ —á–∞—Å—Ç—è–º
    - –¢—ã –ø–æ–ª—É—á–∞–µ—à—å `bot.py`, `weather_app.py`, `storage.py`, `utils.py`
3. **–ö–æ–¥ ‚Üí –ó–∞–ø—É—Å–∫**

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
cp .env.example .env

# 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ .env:
# OW_API_KEY = —Ç–≤–æ–π –∫–ª—é—á –æ—Ç OpenWeatherMap
# BOT_TOKEN = —Ç–≤–æ–π —Ç–æ–∫–µ–Ω –æ—Ç BotFather

# 4. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python bot.py
```

4. **–ó–∞–ø—É—Å–∫ ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
    - –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    - –í—ã–≤–æ–¥–∏—Ç –ø—Ä–æ–≥–Ω–æ–∑ –≤ –∫—Ä–∞—Å–∏–≤–æ–º –≤–∏–¥–µ

***

## **–ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø**

### **–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞:**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –£—Ñ–∞
–ë–æ—Ç: üå°Ô∏è –£—Ñ–∞, –†–æ—Å—Å–∏—è
–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: -8¬∞C
–í–ª–∞–∂–Ω–æ—Å—Ç—å: 65%
–í–µ—Ç–µ—Ä: 3 –º/—Å
–û–ø–∏—Å–∞–Ω–∏–µ: –°–Ω–µ–≥ —Å –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏
```


### **–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π:**

```
[1Ô∏è‚É£ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫] [2Ô∏è‚É£ –í—Ç–æ—Ä–Ω–∏–∫] [3Ô∏è‚É£ –°—Ä–µ–¥–∞]
[4Ô∏è‚É£ –ß–µ—Ç–≤–µ—Ä–≥] [5Ô∏è‚É£ –ü—è—Ç–Ω–∏—Ü–∞] [‚¨ÖÔ∏è –ù–∞–∑–∞–¥]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫"
–ë–æ—Ç –≤—ã–≤–æ–¥–∏—Ç —á–∞—Å–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑ —Å [–ü–æ–¥—Ä–æ–±–Ω–µ–µ] –∏ [–ù–∞–∑–∞–¥]
```


### **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```
üå°Ô∏è –ü–æ–≥–æ–¥–∞ + üí® –ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞
–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 5¬∞C
–î–∞–≤–ª–µ–Ω–∏–µ: 1015 hPa
–£–§-–∏–Ω–¥–µ–∫—Å: 2
–í–æ—Å—Ö–æ–¥: 07:45 | –ó–∞–∫–∞—Ç: 17:30
–ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞: –•–æ—Ä–æ—à–æ
```


### **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**

```
[–í–∫–ª] [–í—ã–∫–ª]
–ï—Å–ª–∏ "–í–∫–ª":
–ò–Ω—Ç–µ—Ä–≤–∞–ª (—á–∞—Å—ã): [^1] [^2] [^3] [^6] [^12] [^24]
‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ User_Data.json
‚Üí –∫–∞–∂–¥—ã–µ N —á–∞—Å–æ–≤ –±–æ—Ç –ø–∏—à–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É
```


***

## **–ö–õ–Æ–ß–ï–í–´–ï –î–ï–¢–ê–õ–ò –ö–û–î–ê**

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ retry:**

```python
# –í–Ω—É—Ç—Ä–∏ WeatherAPI –∏–ª–∏ utils.py
for attempt in range(1, 4):
    try:
        response = requests.get(url)
        response.raise_for_status()
        return response.json()
    except requests.RequestException as e:
        if attempt < 3:
            time.sleep([1, 2, 4][attempt - 1])
        else:
            logger.error(f"Failed after 3 attempts: {e}")
            return None
```


### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º:**

```python
cache_key = f"{lat}_{lon}_weather"
cached_data = load_cache(cache_key)
if cached_data:
    return cached_data

# –ò–Ω–∞—á–µ –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
data = requests.get(...).json()
save_cache(cache_key, data)
return data
```


### **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ:**

```python
import threading

def notification_worker():
    while True:
        time.sleep(300)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        all_users = storage.load_all()
        for user_id, user_data in all_users.items():
            if should_send_notification(user_data):
                # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±–æ—Ç—É
                send_weather_notification(user_id, user_data)

# –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞
notif_thread = threading.Thread(target=notification_worker, daemon=True)
notif_thread.start()
```


***

## **–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò –í –ö–û–î–ï**

–í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ **–Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ**, —É—Ä–æ–≤–µ–Ω—å INFO –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# logger.info(f"–ü–æ–ª—É—á–µ–Ω–∞ –ø–æ–≥–æ–¥–∞ –¥–ª—è {city}: {temperature}¬∞C")
# logger.warning(f"–ì–æ—Ä–æ–¥ {city} –Ω–µ –Ω–∞–π–¥–µ–Ω")
# logger.error(f"–û—à–∏–±–∫–∞ API: {e}")
```


***

## **–†–ï–ó–£–õ–¨–¢–ê–¢**

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø—Ä–æ–º—Ç–∞ –ø–æ–ª—É—á–∏—à—å:

‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π Telegram-–±–æ—Ç
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π
‚úÖ 6 —Ñ—É–Ω–∫—Ü–∏–π: —Ç–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞, –ø—Ä–æ–≥–Ω–æ–∑, –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚úÖ –†—É—Å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–û–û–ü)
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry-–ª–æ–≥–∏–∫–∞
‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

***

–í–æ—Ç –∏ –≤—Å—ë! üöÄ –≠—Ç–æ –ø—Ä–æ–º—Ç –≥–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ **Cursor Composer** –∏–ª–∏ –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –ò–ò-–∫–æ–¥–µ—Ä. –û–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–π, —á—Ç–æ–±—ã –ò–ò –ø–æ–Ω—è–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Å—Ç–æ –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è —Å–æ–∑–¥–∞–ª –µ—â–µ —á—Ç–æ-—Ç–æ?** –ù–∞–ø—Ä–∏–º–µ—Ä:

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–æ–ª–Ω–æ–≥–æ –∫–æ–¥–∞ –ø—Ä—è–º–æ –∑–¥–µ—Å—å?
- –§–∞–π–ª README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏?
- –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?

<div align="center">‚ÅÇ</div>

[^1]: Keis-API-pogoda.docx

[^2]: ARCHITECTURE.md

[^3]: Obektno-orientirovannoe-programmirovanie.docx

